<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <script src="lib/d3.min.js"></script>
    <script src="code.js"></script>
    <script src="lib/array-blur.min.js"></script>

    <script type="x-shader/x-vertex" id="dots-vs">
        attribute vec2 aPos;
        attribute float aSize;
        uniform vec2 screen;
        varying vec2 location;
        varying float radius;

        void main() {
            gl_Position = vec4(aPos, 0.0, 1.0);
            location = screen * (aPos * 0.5 + 0.5);
            radius = aSize / 2.0;
            gl_PointSize = aSize;
        }
    </script>
    <script type="x-shader/x-fragment" id="dots-fs">
        precision mediump float;
        uniform vec3 color;
        varying vec2 location;
        varying float radius;

        float getAlpha(float dist) { //interpolate the last view pixels for smoother dots (antialias für arme)
            float covered = dist / radius;
            float a = 1.0;
            if(covered > 0.95) a = 1.0 - (covered - 0.95) / 0.05;
            return a;
        }

        void main() {
            float dist = distance(location, gl_FragCoord.xy); //distance to original point
            if(dist > radius) discard;

            gl_FragColor = vec4(color, getAlpha(dist));
        }
    </script>
    <script type="x-shader/x-vertex" id="lines-vs">
        attribute vec2 aPos;

        void main() {
            gl_Position = vec4(aPos.xy, 0.0, 1.0);
        }
    </script>
    <script type="x-shader/x-fragment" id="lines-fs">
        precision mediump float;
        uniform vec3 line_color;

        void main() {
            gl_FragColor = vec4(line_color, 1.0);
        }
    </script>
</head>

<body onload="init()">
    <header>
        <h1 class="cohesive">Stippling</h1>
        <h3 class="cohesive">by Philip Ferenz & Alexandra Irger</h3>

        <p class="italic cohesive">Based on the Paper
            <a href="https://ieeexplore.ieee.org/document/8667696" target="_blank" rel="noopener noreferrer">
                »Stippling of 2D Scalar Fields«
            </a>
            by Görtler et al.
        </p>
    </header>

    <div class="app">
        <div class="ui">
            <div class="centerContent">
                <input type="button" value="Upload" onclick="document.getElementById('iUploadImage').click();" />
                <input type="file" style="display:none;" id="iUploadImage"/>
            </div>
            <div>
                <h3 class="centered">Render Settings</h3>
            </div>
            <div>
                <input class="reactive_range" type="range" id="iDotSize" min="0" max="300" value="100">
                <label for="iDotSize">dot size</label>
            </div>
            <div class="greyed">
                <label for="iShape">Shape:</label>
                <select name="shape" id="iShape">
                    <option value="circle">Circle</option>
                    <option value="square">Square</option>
                    <option value="triangle">Triangle</option>
                    <option value="star">Star</option>
                </select>
            </div>
            <div class="greyed">
                color settings ...
            </div>
            <div>
                <h3 class="centered">Stippling Settings</h3>
            </div>
            <div>
                <input type="radio" id="iRegularStippling" name="stipplingType" value="0" onchange="stippler.styleChanged(0)"/>
                <label for="iRegularStippling">regular stippling</label>
                <br>
                <input type="radio" id="iRestrictedStippling" name="stipplingType" value="1" onchange="stippler.styleChanged(1)"/>
                <label for="iRestrictedStippling">restricted stippling</label>
                <br>
                <input type="radio" id="iMachbanding" name="stipplingType" value="2" onchange="stippler.styleChanged(2)"/>
                <label for="iMachbanding">machbanding</label>
            </div>
            <div class="greyed">
                <input class="reactive_range" type="range" id="iDotSizeVariability" min="0" max="15" value="5">
                <label for="iDotSizeVariability">dot size variability</label>
            </div>
            <div class="greyed">
                <input class="reactive_range" type="range" id="iContourSteps" min="0" max="15" value="5">
                <label for="iContourSteps">contour steps DISPLAY ONLY WHEN MB OR RS</label>
            </div>
            <div class="greyed">
                <input class="reactive_range" type="range" id="iGaussSize" min="0" max="300" value="100">
                <label for="iGaussSize">gauss size DISPLAY ONLY WHEN MB</label>
            </div>
            <div class="greyed">
                <input class="reactive_range" type="range" id="iEdgeWeight" min="0" max="300" value="100">
                <label for="iEdgeWeight">edge weight DISPLAY ONLY WHEN MB</label>
            </div>
            <!-- TODO: implement a redrawing of all stipples -->
            <div class="centerContent">
                <input type="button" value="Re-Stipple" onclick="stippler.step();stippler.draw();" /> <!-- check if initialize is needed-->
            </div>
        </div>

        <div class="output">
            <canvas id="d3surface"></canvas>
        </div>
    </div>
</body>
</html>